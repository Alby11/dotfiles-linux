# vim: filetype=zsh

ECHOCAT ".zpackages - installing vital packages..."

#PACKAGE MANAGER
# Determine the package manager and declare the appropriate function and packages
# if $(echo $PACKAGE_MANAGER) = "dnf"; then
if CHECK_COMMANDS dnf && ! CHECK_COMMANDS apt; then
  # Function to check and install package for dnf
  local check_install() {
    if ! dnf list installed "$1" >/dev/null 2>&1; then
      echo $?
      ECHOCAT "$package (pm) is not installed globally. Installing..."
      sudo dnf install -y "$1"
    fi
  }
  local packages=(
    # "cargo"
    # "fd-find"
    "fzf"
    "keychain"
    "nodejs"
    "nodejs-npm"
    "openssl"
    "python3-pip"
    "pkgconf-pkg-config"
    # "ripgrep"
    "openssh-askpass"
  )
# elif $(echo $PACKAGE_MANAGER) = "apt"; then
elif CHECK_COMMANDS apt && ! CHECK_COMMANDS dnf; then
  # Function to check and install package for apt
  local check_install() {
    if ! dpkg -s "$1" >/dev/null 2>&1; then
      ECHOCAT "$package (pm) is not installed globally. Installing..."
      sudo apt update && sudo apt install -y "$1"
    fi
  }
  local packages=(
    "apt-file"
    "apt-utils"
    # "cargo"
    # "fd-find"
    "fzf"
    "keychain"
    "nodejs"
    "npm"
    "openssl"
    "python-is-python3"
    "python3-pip"
    "pkg-config"
    # "ripgrep"
    "ssh-askpass"
  )
fi
for package in $packages; do
  check_install "$package"
done
# CARGO
if ! CHECK_COMMANDS rustup; then
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- --no-modify-path
fi
packages=(
  "bat"
  "eza"
  "fd-find"
  "lolcrab"
  "ripgrep"
  "vivid"
  "zellij"
  "zoxide"
)
for package in $packages; do
  if ! cargo install --list | grep $package >/dev/null 2>&1; then
    ECHOCAT "$package (cargo) is not installed globally. Installing..."
    cargo install $package
  fi
done
# NPM
packages=(
  "neovim"
)
for package in $packages; do
  if ! npm list -g "$package" >/dev/null 2>&1; then
    ECHOCAT "$package (npm) is not installed globally. Installing..."
    sudo npm install -g "$package"
  fi
done
# PIP
packages=(
  "autoenv"
  "neovim"
  "thefuck"
  "virtualenv"
  "virtualenvwrapper"
)
for package in $packages; do
  if ! python -m pip show "$package" > /dev/null 2>&1; then
      ECHOCAT "$package (pip) is not installed globally. Installing..."
      sudo python -m pip install "$package"
  fi
done
