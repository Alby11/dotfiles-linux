# vim: filetype=zsh

function unmount_share() {
    if [[ $1 == "-h" ]]; then
        echo "Usage: unmount_share"
        echo "Unmounts a previously mounted network share."
        return
    fi

    local mount_point
    # local FZF_DEFAULT_OPTS_SAVE=$FZF_DEFAULT_OPTS
    local FZF_DEFAULT_OPTS="--color=bw"
    mount_point=$(/usr/bin/ls $HOME/mnt | fzf --no-color)
    # mount_point=$(/usr/bin/ls $HOME/mnt)
    # mount_point=$(/usr/bin/ls /home/$USER/mnt | fzf --no-color)
    # mount_point=$(/usr/bin/ls /home/$USER/mnt)
    # FZF_DEFAULT_OPTS=$FZF_DEFAULT_OPTS_SAVE
    # unset $FZF_DEFAULT_OPTS_SAVE
    mount_point=$(echo "$HOME/mnt/$mount_point")
    echo "Unmounting: $mount_point"
    if [[ -n $mount_point ]]; then
        sudo fusermount -u "${mount_point}/dst"
        sudo umount "${mount_point}/src"
        rmdir "${mount_point}/dst"
        rmdir "${mount_point}/src"
        rmdir "${mount_point}"
    fi
}
