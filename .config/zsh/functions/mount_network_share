mount_network_share() {
  local OPTIND
  local opt
  local username
  username=$(whoami)
  local domain
  local server
  local share
  local protocol="samba"
  local cifs_error_message
  cifs_error_message="Mount failed. If you're seeing:
    \n\t'user CIFS mounts not supported'\n
    this typically means that the mount.cifs program
    needs to be installed as setuid root. This can be done with:
    \n\t'sudo chmod u+s $(which mount.cifs)'.\n
    You can also do this by adding a line like this to your sudoers file:
    \n\t$(whoami) ALL=(root) NOPASSWD: $(which mount.cifs)\n
    In both cases, please be aware of the security implications."
  help_text="Usage: mount_network_share -s [server] -r [share] -u [username] -d [domain] -p [protocol]
  Mounts a network share at the specified server.
  Options:
    -s    Specifies the server to connect to.
    -r    Specifies the remote share to mount.
    -u    Specifies the username (default is current session's username).
    -d    Specifies the domain (optional).
    -p    Specifies the protocol (default is samba, can also be nfs)."

  while getopts "u:d:s:r:p:h" opt; do
    case "${opt}" in
      u)
        username=$OPTARG
        ;;
      d)
        domain=$OPTARG
        ;;
      s)
        server=$OPTARG
        ;;
      r)
        share=$OPTARG
        ;;
      p)
        protocol=$OPTARG
        ;;
      h)
       echo "$help_text"
       return 0
       ;;
     \?)
      echo "Invalid option: -$OPTARG" >&2
      return 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      return 1
      ;;
   esac 
  done

  if [[ -z $server ]] || [[ -z $share ]]; then
    echo "Server and share parameters are required."
    return 1
  fi

  local mountpoint="$HOME/mnt/${server}_${share}"
  if [[ ! -d $mountpoint ]]; then
    mkdir -p "$mountpoint"
  fi

  if [[ $protocol == "samba" ]]; then
    if [[ -n $domain ]]; then 
      /usr/sbin/mount.cifs "//${server}/${share}" "${mountpoint}" -o user="$username",dom="$domain" || echo "$cifs_error_message" && \
        sudo mount -t cifs "//${server}/${share}" "${mountpoint}" -o username="$username",domain="$domain"
    else 
      /usr/sbin/mount.cifs "//${server}/${share}" "${mountpoint}" -o user="$username" || echo "$cifs_error_message" && \
        sudo mount -t cifs "//${server}/${share}" "${mountpoint}" -o username="$username"
    fi 
  elif [[ $protocol == "nfs" ]]; then 
    mount -t nfs "//$server/$share $mountpoint" || echo "Mount failed. Please check your NFS settings and try again."
  else 
    echo "Invalid protocol. Please specify either 'samba' or 'nfs'."
    return 1 
  fi 
}
