#!/usr/bin/env zsh

#
# .zeditor - Zsh file loaded to export editor, visual, pager ...
#

ECHOCAT '.zeditor - Zsh file loaded to export editor, visual, pager ...'

#
# Editors
#

export EDITOR="$(which vim > /dev/null 2>&1)"
export VISUAL="$EDITOR"
export PAGER="$(which less)"
export MANPAGER="$PAGER"
### Setting up less
# Highlight section titles in manual pages.
export LESS_TERMCAP_md="${yellow}"
if CHECK_COMMANDS lesspipe.sh; then
  lesspipe.sh | source /dev/stdin
else
  ECHOCAT 'LESSOPEN: lesspipe.sh in not installed or in PATH' -i
fi
if CHECK_COMMANDS bat; then
  bat cache --build >/dev/null 2>&1
  export LESSCOLORIZER="bat --style=full --theme=catppuccin-mocha"
fi
if CHECK_COMMANDS batpipe; then
  # To use batpipe, eval the output of this command in your shell init script.
  export LESSOPEN="|$(which batpipe) %s"
  export LESSOPEN
  unset LESSCLOSE
  # The following will enable colors when using batpipe with less:
  export LESS="$LESS -R"
  export BATPIPE="color"
  export LESS
  export BATPIPE
fi
# Neovim nightly with bob
if ! CHECK_COMMANDS nvim > /dev/null ; then
  if ! CHECK_COMMANDS bob ; then
    if ! CHECK_COMMANDS cargo ; then
      package_manager_install cargo
    fi
    cargo install \
      --git https://github.com/MordechaiHadad/bob.git \
      --no-default-features \
      --features native-tls
  fi
  mkdir -p $HOME/.local/share/bash-completion/completions
  bob complete bash > $HOME/.local/share/bash-completion/completions/bob
  bob complete zsh > $ZDOTDIR/completions/_bob
  export PATH=$PATH:$HOME/.local/share/bob/nvim-bin
  bob use nightly
fi
export EDITOR="${$(which nvim):-$EDITOR}"
export VISUAL="${$(which nvim):-$VISUAL}"
export PAGER="${$(which nvim):-$PAGER}"
export MANPAGER="$(which nvim) -c 'Man!' -o -"
