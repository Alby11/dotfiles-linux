# vim: filetype=zsh

if [ ! -f $ZDOTDIR/functions/dotfiles ]; then
  echo "dotfiles function missing, something is wrong with user profile."
  return 1
fi

dotfiles() {
    git --git-dir="$HOME"/.dotfiles_git/ --work-tree="$HOME" "$@"
}

mkdir -p ${HOME}/gitdepot
[[ -d $HOME/gitdepot ]] && export gitdepot=${HOME}/gitdepot
submodules=(
  "junegunn/fzf/bin"
)
for submodule in $submodules; do
  submodule_url=$(echo $submodule | cut -d '/' -f -2)
  submodule_dir=$(echo $submodule_url | sed -s 's/\//\_/')
  submodule_subdir=$(echo $submodule | cut -d '/' -f 3)
  submodule_path=${submodule_dir}/$(echo $submodule | cut -d '/' -f 3)
  export PATH="${PATH}":"${gitdepot}/${submodule_path}"
  if [ -d ${gitdepot}/${submodule_dir} ]; then
    break
  fi
  echo $submodule is not present, cloning...
  dotfiles submodule add git@github.com:${submodule}.git ${gitdepot}/${submodule_dir}
done
